import{_ as de}from"./index-398ba06f.js";import{f as L}from"./date-6033e12c.js";/* empty css                             *//* empty css                 *//* empty css                        *//* empty css               *//* empty css               *//* empty css                       */import{a7 as S,Q as ie,a8 as se,a6 as pe,a9 as me,aa as ce,ab as _e,Y as r,M as fe,ad as be,ae as ge,an as ve,a5 as ye,ah as we,af as De,ag as Ve,a4 as Te,a2 as he,am as Pe,ao as ke,ap as Ce,aq as Ee}from"./element-plus-a4f5b2a7.js";import{r as c,M as Y,c as G,f as xe,l as T,m as M,q as y,G as e,A as t,B as qe,z as Q,u as I,E as n,F as Se,W as Ye,D as Me}from"./vue-vendor-76d6b13b.js";const Ie={class:"outbound-container"},Fe={class:"page-header"},Ne={class:"search-bar"},Ue={class:"table-container"},Oe={class:"pagination-container"},Re={key:0,class:"stock-info"},ze={class:"dialog-footer"},Ae={__name:"outbound",setup($e){const h=c(!1),P=c([]),w=c(!1),k=c(!1),D=c(),d=c({}),_=Y({productName:"",dateRange:[]}),m=Y({page:1,limit:20,total:0}),u=Y({productId:"",outboundType:"",quantity:1,retailPrice:0,outboundDate:new Date().toISOString().split("T")[0],notes:""}),W={productId:[{required:!0,message:"请选择商品",trigger:"change"}],outboundType:[{required:!0,message:"请选择出库类型",trigger:"change"}],quantity:[{required:!0,message:"请输入出库数量",trigger:"blur"}],retailPrice:[{required:!0,message:"请输入零售单价",trigger:"blur"}],outboundDate:[{required:!0,message:"请选择出库日期",trigger:"change"}]},C=c([{_id:"1",name:"景田矿泉水",brand:"景田",specification:"550ml",unit:"瓶",retailPrice:2,currentStock:120},{_id:"2",name:"百岁山矿泉水",brand:"百岁山",specification:"570ml",unit:"瓶",retailPrice:2.5,currentStock:8}]),f=G(()=>C.value.find(o=>o._id===u.productId)),H=G(()=>u.quantity*u.retailPrice),F=o=>({sale:"success",loss:"danger",return:"warning",transfer:"info"})[o]||"info",N=o=>({sale:"销售出库",loss:"损耗出库",return:"退货出库",transfer:"调拨出库"})[o]||"未知",b=async()=>{h.value=!0;try{await new Promise(o=>setTimeout(o,500)),P.value=[{_id:"1",productName:"景田矿泉水",brand:"景田",specification:"550ml",quantity:20,unit:"瓶",retailPrice:2,totalAmount:40,outboundType:"sale",outboundDate:new Date("2024-01-16"),operator:"admin",notes:"正常销售"},{_id:"2",productName:"百岁山矿泉水",brand:"百岁山",specification:"570ml",quantity:2,unit:"瓶",retailPrice:2.5,totalAmount:5,outboundType:"loss",outboundDate:new Date("2024-01-21"),operator:"admin",notes:"包装破损"}],m.total=P.value.length}catch{S.error("获取出库记录失败")}finally{h.value=!1}},J=o=>{const l=C.value.find(E=>E._id===o);l&&(u.retailPrice=l.retailPrice)},U=()=>{},K=()=>{b()},X=()=>{Object.assign(_,{productName:"",dateRange:[]}),b()},Z=o=>{m.limit=o,b()},ee=o=>{m.page=o,b()},te=async()=>{if(D.value)try{if(await D.value.validate(),f.value&&u.quantity>f.value.currentStock){S.error("出库数量不能超过当前库存");return}await new Promise(o=>setTimeout(o,500)),S.success("出库成功"),w.value=!1,le(),b()}catch(o){console.error("表单验证失败:",o)}},ae=o=>{d.value={...o},k.value=!0},le=()=>{Object.assign(u,{productId:"",outboundType:"",quantity:1,retailPrice:0,outboundDate:new Date().toISOString().split("T")[0],notes:""}),D.value&&D.value.clearValidate()};return xe(()=>{b()}),(o,l)=>{const E=fe,g=ie,x=be,s=ge,O=ve,R=se,i=ye,z=we,oe=pe,ne=me,V=De,A=Ve,v=Te,q=he,$=Pe,B=ce,p=ke,ue=Ce,re=_e;return T(),M("div",Ie,[y("div",Fe,[l[15]||(l[15]=y("h2",null,"商品出库",-1)),e(g,{type:"primary",onClick:l[0]||(l[0]=a=>w.value=!0)},{default:t(()=>[e(E,null,{default:t(()=>[e(I(Ee))]),_:1}),l[14]||(l[14]=n(" 新增出库 ",-1))]),_:1,__:[14]})]),y("div",Ne,[e(R,{inline:!0,model:_,class:"search-form"},{default:t(()=>[e(s,{label:"商品名称"},{default:t(()=>[e(x,{modelValue:_.productName,"onUpdate:modelValue":l[1]||(l[1]=a=>_.productName=a),placeholder:"请输入商品名称",clearable:""},null,8,["modelValue"])]),_:1}),e(s,{label:"出库日期"},{default:t(()=>[e(O,{modelValue:_.dateRange,"onUpdate:modelValue":l[2]||(l[2]=a=>_.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(s,null,{default:t(()=>[e(g,{type:"primary",onClick:K},{default:t(()=>l[16]||(l[16]=[n("搜索",-1)])),_:1,__:[16]}),e(g,{onClick:X},{default:t(()=>l[17]||(l[17]=[n("重置",-1)])),_:1,__:[17]})]),_:1})]),_:1},8,["model"])]),y("div",Ue,[qe((T(),Q(oe,{data:P.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(i,{prop:"productName",label:"商品名称",width:"150"}),e(i,{prop:"brand",label:"品牌",width:"100"}),e(i,{prop:"specification",label:"规格",width:"100"}),e(i,{prop:"quantity",label:"出库数量",width:"100"}),e(i,{prop:"unit",label:"单位",width:"60"}),e(i,{prop:"retailPrice",label:"零售单价",width:"100"},{default:t(a=>[n(" ¥"+r(a.row.retailPrice.toFixed(2)),1)]),_:1}),e(i,{prop:"totalAmount",label:"总金额",width:"100"},{default:t(a=>[n(" ¥"+r(a.row.totalAmount.toFixed(2)),1)]),_:1}),e(i,{prop:"outboundType",label:"出库类型",width:"100"},{default:t(a=>[e(z,{type:F(a.row.outboundType)},{default:t(()=>[n(r(N(a.row.outboundType)),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"outboundDate",label:"出库日期",width:"120"},{default:t(a=>[n(r(I(L)(a.row.outboundDate)),1)]),_:1}),e(i,{prop:"operator",label:"操作员",width:"100"}),e(i,{prop:"notes",label:"备注","min-width":"120"}),e(i,{label:"操作",width:"100",fixed:"right"},{default:t(a=>[e(g,{size:"small",onClick:j=>ae(a.row)},{default:t(()=>l[18]||(l[18]=[n("查看",-1)])),_:2,__:[18]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[re,h.value]]),y("div",Oe,[e(ne,{"current-page":m.page,"onUpdate:currentPage":l[3]||(l[3]=a=>m.page=a),"page-size":m.limit,"onUpdate:pageSize":l[4]||(l[4]=a=>m.limit=a),"page-sizes":[10,20,50,100],total:m.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Z,onCurrentChange:ee},null,8,["current-page","page-size","total"])])]),e(B,{modelValue:w.value,"onUpdate:modelValue":l[12]||(l[12]=a=>w.value=a),title:"新增出库",width:"800px"},{footer:t(()=>[y("span",ze,[e(g,{onClick:l[11]||(l[11]=a=>w.value=!1)},{default:t(()=>l[19]||(l[19]=[n("取消",-1)])),_:1,__:[19]}),e(g,{type:"primary",onClick:te},{default:t(()=>l[20]||(l[20]=[n("确定",-1)])),_:1,__:[20]})])]),default:t(()=>[e(R,{ref_key:"outboundFormRef",ref:D,model:u,rules:W,"label-width":"100px"},{default:t(()=>[e(q,{gutter:20},{default:t(()=>[e(v,{span:12},{default:t(()=>[e(s,{label:"商品",prop:"productId"},{default:t(()=>[e(A,{modelValue:u.productId,"onUpdate:modelValue":l[5]||(l[5]=a=>u.productId=a),placeholder:"请选择商品",filterable:"",style:{width:"100%"},onChange:J},{default:t(()=>[(T(!0),M(Se,null,Ye(C.value,a=>(T(),Q(V,{key:a._id,label:`${a.name} - ${a.brand} (库存: ${a.currentStock})`,value:a._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(v,{span:12},{default:t(()=>[e(s,{label:"出库类型",prop:"outboundType"},{default:t(()=>[e(A,{modelValue:u.outboundType,"onUpdate:modelValue":l[6]||(l[6]=a=>u.outboundType=a),placeholder:"请选择出库类型",style:{width:"100%"}},{default:t(()=>[e(V,{label:"销售出库",value:"sale"}),e(V,{label:"损耗出库",value:"loss"}),e(V,{label:"退货出库",value:"return"}),e(V,{label:"调拨出库",value:"transfer"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(q,{gutter:20},{default:t(()=>[e(v,{span:12},{default:t(()=>[e(s,{label:"出库数量",prop:"quantity"},{default:t(()=>{var a;return[e($,{modelValue:u.quantity,"onUpdate:modelValue":l[7]||(l[7]=j=>u.quantity=j),min:1,max:((a=f.value)==null?void 0:a.currentStock)||999,style:{width:"100%"},onChange:U},null,8,["modelValue","max"]),f.value?(T(),M("div",Re," 当前库存: "+r(f.value.currentStock)+" "+r(f.value.unit),1)):Me("",!0)]}),_:1})]),_:1}),e(v,{span:12},{default:t(()=>[e(s,{label:"零售单价",prop:"retailPrice"},{default:t(()=>[e($,{modelValue:u.retailPrice,"onUpdate:modelValue":l[8]||(l[8]=a=>u.retailPrice=a),precision:2,step:.1,min:0,style:{width:"100%"},onChange:U},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(q,{gutter:20},{default:t(()=>[e(v,{span:12},{default:t(()=>[e(s,{label:"总金额"},{default:t(()=>[e(x,{value:`¥${H.value.toFixed(2)}`,readonly:"",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1}),e(v,{span:12},{default:t(()=>[e(s,{label:"出库日期",prop:"outboundDate"},{default:t(()=>[e(O,{modelValue:u.outboundDate,"onUpdate:modelValue":l[9]||(l[9]=a=>u.outboundDate=a),type:"date",placeholder:"选择出库日期",style:{width:"100%"},format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(s,{label:"备注"},{default:t(()=>[e(x,{modelValue:u.notes,"onUpdate:modelValue":l[10]||(l[10]=a=>u.notes=a),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(B,{modelValue:k.value,"onUpdate:modelValue":l[13]||(l[13]=a=>k.value=a),title:"出库详情",width:"600px"},{default:t(()=>[e(ue,{column:2,border:""},{default:t(()=>[e(p,{label:"商品名称"},{default:t(()=>[n(r(d.value.productName),1)]),_:1}),e(p,{label:"品牌"},{default:t(()=>[n(r(d.value.brand),1)]),_:1}),e(p,{label:"规格"},{default:t(()=>[n(r(d.value.specification),1)]),_:1}),e(p,{label:"出库数量"},{default:t(()=>[n(r(d.value.quantity)+" "+r(d.value.unit),1)]),_:1}),e(p,{label:"零售单价"},{default:t(()=>{var a;return[n("¥"+r((a=d.value.retailPrice)==null?void 0:a.toFixed(2)),1)]}),_:1}),e(p,{label:"总金额"},{default:t(()=>{var a;return[n("¥"+r((a=d.value.totalAmount)==null?void 0:a.toFixed(2)),1)]}),_:1}),e(p,{label:"出库类型"},{default:t(()=>[e(z,{type:F(d.value.outboundType)},{default:t(()=>[n(r(N(d.value.outboundType)),1)]),_:1},8,["type"])]),_:1}),e(p,{label:"出库日期"},{default:t(()=>[n(r(I(L)(d.value.outboundDate)),1)]),_:1}),e(p,{label:"操作员"},{default:t(()=>[n(r(d.value.operator),1)]),_:1}),e(p,{label:"备注",span:2},{default:t(()=>[n(r(d.value.notes||"无"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Ze=de(Ae,[["__scopeId","data-v-7b0e64d2"]]);export{Ze as default};
