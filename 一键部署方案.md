# 便利店进销存系统 - 一键部署方案

## 🚀 快速开始

### 方式一：超级一键部署（推荐）
```bash
# 运行智能部署脚本
./one-click-deploy.sh
```

### 方式二：简单一键部署
```bash
# 运行基础部署脚本
./deploy-render.sh
```

## 📋 部署方案对比

| 特性 | 超级一键部署 | 简单一键部署 |
|------|-------------|-------------|
| 环境检查 | ✅ 自动检查 | ❌ 手动检查 |
| 依赖安装 | ✅ 自动安装 | ❌ 手动安装 |
| 前端构建 | ✅ 自动构建 | ❌ 手动构建 |
| Git 管理 | ✅ 智能提交 | ✅ 基础推送 |
| 环境变量 | ✅ 自动生成 | ❌ 手动配置 |
| 错误处理 | ✅ 详细提示 | ❌ 基础提示 |
| 部署指导 | ✅ 详细指南 | ✅ 基础指南 |

## 🎯 超级一键部署详细流程

### 第一阶段：环境准备
1. **系统检查**
   - ✅ Git 安装检查
   - ✅ Node.js 版本检查
   - ✅ npm 可用性检查
   - ✅ 项目结构验证

2. **依赖管理**
   - 🔄 自动安装后端依赖
   - 🔄 自动安装前端依赖
   - 🔄 自动构建前端应用

### 第二阶段：代码管理
3. **Git 状态检查**
   - 🔍 检查远程仓库配置
   - 🔍 检查未提交的更改
   - 🤖 智能提交管理
   - 📤 自动推送到远程仓库

### 第三阶段：配置生成
4. **环境变量配置**
   - 🔐 自动生成 JWT 密钥
   - 📝 创建环境变量模板
   - 📋 生成配置清单

### 第四阶段：部署指导
5. **详细部署指南**
   - 🌐 Render 控制台操作步骤
   - ⚙️ Blueprint 部署流程
   - 🔧 环境变量配置指导
   - 📱 部署后验证方法

## 🛠️ 使用说明

### 运行超级一键部署
```bash
# 确保在项目根目录
cd /Users/suizhihao/Trae/ke

# 运行部署脚本
./one-click-deploy.sh
```

### 脚本执行过程
1. **交互式确认**：脚本会询问是否继续执行
2. **自动化检查**：检查所有必要的环境和依赖
3. **智能处理**：自动处理常见问题和配置
4. **详细指导**：提供完整的后续操作指南

### 生成的文件
- `.env.render` - 环境变量配置模板
- 构建输出 - 前端 dist 目录
- Git 提交 - 自动提交所有更改

## 🔧 环境变量配置

脚本会自动生成 `.env.render` 文件，包含：

```env
# 后端 API 服务环境变量
NODE_ENV=production
MONGODB_URI=mongodb+srv://用户名:密码@cluster.mongodb.net/convenience_store
JWT_SECRET=自动生成的32位密钥

# 前端静态网站环境变量
VITE_API_URL=https://ke-inventory-api.onrender.com
```

## 🌐 Render 部署步骤

### 1. 访问 Render 控制台
- 打开 https://render.com
- 使用 GitHub 账号登录

### 2. 创建 Blueprint 部署
- 点击 "New" → "Blueprint"
- 选择你的 GitHub 仓库
- Render 自动读取 `render.yaml` 配置

### 3. 配置环境变量
- 使用生成的 `.env.render` 文件内容
- 特别注意配置 `MONGODB_URI`

### 4. 启动部署
- 点击 "Create Blueprint"
- 等待部署完成（约2-5分钟）

## 📱 部署后验证

### 访问地址
- **前端**: https://ke-inventory.onrender.com
- **API**: https://ke-inventory-api.onrender.com
- **健康检查**: https://ke-inventory-api.onrender.com/health

### 功能测试
1. 访问前端页面
2. 测试用户注册功能
3. 测试登录功能
4. 验证各个业务模块

## ⚠️ 重要提醒

### 免费层级限制
- **使用时间**: 750小时/月
- **休眠机制**: 15分钟无活动后休眠
- **冷启动**: 首次访问需要约50秒

### 必要配置
- **MongoDB Atlas**: 确保允许来自任何 IP 的连接
- **环境变量**: 必须正确配置所有必需变量
- **域名配置**: 部署后可能需要更新 CORS 设置

## 🆘 故障排除

### 常见问题
1. **脚本执行失败**
   - 检查是否在项目根目录
   - 确保有执行权限：`chmod +x one-click-deploy.sh`

2. **依赖安装失败**
   - 检查网络连接
   - 清除 npm 缓存：`npm cache clean --force`

3. **Git 推送失败**
   - 检查远程仓库配置
   - 确认 GitHub 访问权限

4. **部署失败**
   - 查看 Render Dashboard 日志
   - 检查环境变量配置
   - 验证 MongoDB 连接字符串

### 获取帮助
- 查看详细日志输出
- 参考相关文档：
  - `Render部署指南.md`
  - `Render环境变量配置清单.md`
  - `MongoDB Atlas配置指南.md`

## 🎉 成功部署后

### 下一步操作
1. **配置自定义域名**（可选）
2. **设置监控和告警**
3. **配置备份策略**
4. **优化性能设置**

### 升级选项
- **Starter Plan**: $7/月，无休眠限制
- **Professional Plan**: $25/月，更多资源
- **自定义域名**: 免费 SSL 证书

---

**🚀 现在就开始你的一键部署之旅吧！**

运行 `./one-click-deploy.sh` 开始部署，脚本会引导你完成整个过程。