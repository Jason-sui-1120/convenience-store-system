<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API连接测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #409EFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #337ecc;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .success {
            background: #f0f9ff;
            border: 1px solid #10b981;
            color: #065f46;
        }
        .error {
            background: #fef2f2;
            border: 1px solid #ef4444;
            color: #991b1b;
        }
        .info {
            background: #f8fafc;
            border: 1px solid #6b7280;
            color: #374151;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>API连接测试</h1>
        <p>API基础URL: <strong id="api-url"></strong></p>
        
        <div>
            <button class="test-button" onclick="testSummary()">测试统计数据</button>
            <button class="test-button" onclick="testSuppliers()">测试供应商</button>
            <button class="test-button" onclick="testInbound()">测试入库记录</button>
            <button class="test-button" onclick="testOutbound()">测试出库记录</button>
            <button class="test-button" onclick="testAll()">测试所有API</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        // API配置
        const API_BASE_URL = 'https://1371559131-0yd2evf4vy.ap-beijing.tencentscf.com/api';
        
        const API_ENDPOINTS = {
            REPORTS: {
                STATS: '/reports/summary'
            },
            SUPPLIERS: {
                LIST: '/suppliers'
            },
            INBOUND: {
                LIST: '/inbound'
            },
            OUTBOUND: {
                LIST: '/outbound'
            }
        };

        document.getElementById('api-url').textContent = API_BASE_URL;

        function addResult(message, data = null, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            
            let content = `[${new Date().toLocaleTimeString()}] ${message}`;
            if (data) {
                content += '\n' + JSON.stringify(data, null, 2);
            }
            
            resultDiv.textContent = content;
            resultsDiv.appendChild(resultDiv);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        async function makeRequest(endpoint, description) {
            const url = `${API_BASE_URL}${endpoint}`;
            addResult(`开始请求: ${description} - ${url}`);
            
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                addResult(`${description} - 成功`, data, 'success');
                return data;
            } catch (error) {
                addResult(`${description} - 失败: ${error.message}`, null, 'error');
                throw error;
            }
        }

        async function testSummary() {
            try {
                await makeRequest(API_ENDPOINTS.REPORTS.STATS, '统计数据');
            } catch (error) {
                console.error('统计数据测试失败:', error);
            }
        }

        async function testSuppliers() {
            try {
                await makeRequest(API_ENDPOINTS.SUPPLIERS.LIST, '供应商列表');
            } catch (error) {
                console.error('供应商测试失败:', error);
            }
        }

        async function testInbound() {
            try {
                await makeRequest(API_ENDPOINTS.INBOUND.LIST, '入库记录');
            } catch (error) {
                console.error('入库记录测试失败:', error);
            }
        }

        async function testOutbound() {
            try {
                await makeRequest(API_ENDPOINTS.OUTBOUND.LIST, '出库记录');
            } catch (error) {
                console.error('出库记录测试失败:', error);
            }
        }

        async function testAll() {
            addResult('开始测试所有API端点...');
            
            const tests = [
                { fn: testSummary, name: '统计数据' },
                { fn: testSuppliers, name: '供应商' },
                { fn: testInbound, name: '入库记录' },
                { fn: testOutbound, name: '出库记录' }
            ];

            for (const test of tests) {
                try {
                    await test.fn();
                    await new Promise(resolve => setTimeout(resolve, 500)); // 延迟500ms
                } catch (error) {
                    addResult(`${test.name}测试失败`, null, 'error');
                }
            }
            
            addResult('所有API测试完成');
        }

        // 页面加载时自动测试
        window.onload = function() {
            addResult('页面加载完成，准备测试API连接');
            setTimeout(testAll, 1000);
        };
    </script>
</body>
</html>