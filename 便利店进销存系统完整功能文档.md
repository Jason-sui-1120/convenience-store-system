# 便利店进销存系统 - 完整功能文档

> 基于实际代码实现的功能文档  
> 更新时间: 2025年1月8日  
> 版本: v1.0.0

## 🎯 系统概述

便利店进销存管理系统是一个完整的库存管理解决方案，包含商品管理、供应商管理、入库管理、出库管理和数据统计等核心功能。系统采用现代化的技术栈，提供直观的用户界面和强大的数据管理能力。

## 🏗️ 技术架构

### 前端技术栈
- **Vue 3** - 现代化前端框架
- **Element Plus** - UI组件库
- **Vue Router** - 路由管理
- **ECharts** - 数据可视化图表
- **Vite** - 构建工具

### 后端技术栈
- **Node.js** - 运行时环境
- **Express.js** - Web框架（生产环境）
- **Hono** - 轻量级框架（测试环境）
- **Supabase** - 数据库服务

### 数据库设计
- **Supabase PostgreSQL** - 主数据库
- **标准关系型设计** - 外键关联
- **实时数据同步** - 支持实时更新

## 🚀 系统启动

### 开发环境启动

1. **启动测试后端服务器**
   ```bash
   cd edge-functions
   node test-local.js
   ```
   - 服务地址: `http://localhost:3001`
   - 提供模拟数据和API接口

2. **启动前端开发服务器**
   ```bash
   cd frontend
   npm run dev
   ```
   - 服务地址: `http://localhost:5174`
   - 热重载开发环境

3. **启动生产后端服务器**
   ```bash
   cd backend
   npm start
   ```
   - 连接Supabase数据库
   - 完整API功能

## 📋 核心功能模块

### 1. 📊 仪表板 (Dashboard)

**访问路径**: `/`

**主要功能**:
- **关键指标展示**
  - 商品总数统计
  - 供应商数量统计
  - 库存预警商品数量
  - 今日入库/出库统计

- **数据可视化**
  - 商品分类分布饼图
  - 品牌分布柱状图
  - 实时数据更新

- **快捷操作**
  - 快速添加商品
  - 快速入库/出库
  - 库存预警提醒

**技术实现**:
```javascript
// API端点: GET /api/reports/dashboard
// 返回数据结构
{
  success: true,
  data: {
    totalProducts: 150,
    totalSuppliers: 25,
    lowStockProducts: 8,
    todayInbound: 12,
    todayOutbound: 18,
    categoryStats: [
      { name: '饮料', value: 45 },
      { name: '零食', value: 32 }
    ],
    brandStats: [
      { name: '可口可乐', value: 15 },
      { name: '康师傅', value: 12 }
    ]
  }
}
```

### 2. 📦 商品管理 (Products)

**访问路径**: `/products`

**核心功能**:
- **商品列表管理**
  - 分页显示商品信息
  - 搜索和筛选功能
  - 批量操作支持

- **商品信息维护**
  - 添加新商品
  - 编辑商品信息
  - 删除商品记录
  - 商品状态管理

**商品字段结构**:
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| name | String | 是 | 商品名称 |
| brand | String | 是 | 商品品牌 |
| category | String | 是 | 商品分类 |
| specification | String | 是 | 商品规格 |
| purchasePrice | Number | 是 | 进货价格 |
| inputPrice | Number | 是 | 录入价格 |
| retailPrice | Number | 是 | 零售价格 |
| currentStock | Number | 是 | 当前库存 |
| stockAlert | Number | 否 | 库存预警值 |
| unit | String | 是 | 计量单位 |
| barcode | String | 否 | 商品条码 |

**商品-供应商关联**:
- 商品与供应商通过 `supplier_products` 中间表建立多对多关系
- 支持一个商品对应多个供应商的业务场景
- 可设置主要供应商 (`is_primary` 字段)
- 入库时自动维护商品-供应商关联关系

**API接口**:
```javascript
// 获取商品列表
GET /api/products?page=1&limit=20&search=可乐&category=饮料

// 创建商品
POST /api/products
{
  "name": "可口可乐",
  "brand": "可口可乐",
  "category": "饮料",
  "specification": "500ml",
  "purchasePrice": 2.5,
  "retailPrice": 3.5,
  "currentStock": 100,
  "stockAlert": 20,
  "unit": "瓶"
}

// 更新商品
PUT /api/products/:id

// 删除商品
DELETE /api/products/:id
```

### 3. 🏢 供应商管理 (Suppliers)

**访问路径**: `/suppliers`

**核心功能**:
- **供应商档案管理**
  - 供应商基本信息维护
  - 联系方式管理
  - 供应商状态控制

- **供应关系管理**
  - 供应商与商品多对多关联
  - 主要供应商设置
  - 供货历史记录
  - 供应商商品价格管理

**供应商-商品关联特性**:
- 通过 `supplier_products` 中间表实现多对多关系
- 支持一个供应商供应多种商品
- 支持一种商品由多个供应商供应
- 可设置主要供应商标识 (`is_primary`)
- 入库时自动维护供应商-商品关联关系
- 商品选择时智能推荐相关供应商

**供应商字段结构**:
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| name | String | 是 | 供应商名称 |
| contact | String | 是 | 联系人姓名 |
| phone | String | 是 | 联系电话 |
| address | String | 否 | 供应商地址 |
| paymentMethod | String | 是 | 付款方式 |
| hasInvoice | Boolean | 是 | 是否开票 |
| status | String | 是 | 供应商状态 |
| remark | String | 否 | 备注信息 |

**API接口**:
```javascript
// 获取供应商列表
GET /api/suppliers?page=1&limit=20&search=北京&status=active

// 创建供应商
POST /api/suppliers
{
  "name": "北京食品供应商",
  "contact": "张经理",
  "phone": "13800138001",
  "address": "北京市朝阳区",
  "paymentMethod": "银行转账",
  "hasInvoice": true,
  "status": "active"
}
```

### 4. 📥 入库管理 (Inbound)

**访问路径**: `/inventory/inbound`

**核心功能**:
- **入库记录管理**
  - 新增入库记录
  - 入库历史查询
  - 入库状态跟踪

- **库存自动更新**
  - 入库后自动增加库存
  - 成本价格更新
  - 供应商关联记录

**入库记录字段**:
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| product_id | Number | 是 | 商品ID |
| supplier_id | Number | 是 | 供应商ID |
| quantity | Number | 是 | 入库数量 |
| unit_price | Number | 是 | 入库单价 |
| total_amount | Number | 是 | 入库总金额 |
| date | String | 是 | 入库日期 |
| notes | String | 否 | 备注信息 |

**入库流程**:
1. 选择商品（从商品列表选择）
2. 选择供应商（系统显示该商品的所有关联供应商）
3. 输入入库数量和价格
4. 选择入库日期
5. 添加备注信息
6. 提交入库记录
7. 系统自动更新库存和供应商关联关系

**智能供应商推荐**:
- 商品选择后自动显示相关供应商列表
- 优先显示主要供应商 (`is_primary = true`)
- 显示历史采购价格作为参考
- 支持新增供应商-商品关联关系

### 5. 📤 出库管理 (Outbound)

**访问路径**: `/inventory/outbound`

**核心功能**:
- **出库记录管理**
  - 新增出库记录
  - 出库历史查询
  - 出库类型分类

- **库存自动扣减**
  - 出库后自动减少库存
  - 库存不足检查
  - 销售记录统计

**出库记录字段**:
| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| product_id | Number | 是 | 商品ID |
| quantity | Number | 是 | 出库数量 |
| unit_price | Number | 是 | 出库单价 |
| total_amount | Number | 是 | 出库总金额 |
| date | String | 是 | 出库日期 |
| customer_name | String | 否 | 客户名称 |
| notes | String | 否 | 备注信息 |
| status | String | 是 | 出库状态 |

**出库流程**:
1. 选择商品
2. 检查库存是否充足
3. 输入出库数量和价格
4. 选择出库日期
5. 添加客户信息（可选）
6. 提交出库记录
7. 系统自动扣减库存

## 🔧 系统特性

### 数据验证
- **前端验证**: 表单实时验证，用户友好提示
- **后端验证**: 数据完整性检查，防止无效数据
- **业务逻辑验证**: 库存检查，重复数据防护

### 自动计算
- **金额计算**: 数量×单价自动计算总金额
- **库存更新**: 入库/出库自动更新商品库存
- **统计数据**: 实时计算各类统计指标

### 用户体验
- **响应式设计**: 支持桌面和移动设备
- **加载状态**: 操作过程中显示加载提示
- **错误处理**: 友好的错误信息提示
- **操作反馈**: 成功/失败操作及时反馈

### 性能优化
- **分页加载**: 大数据量分页显示
- **搜索过滤**: 快速定位目标数据
- **缓存机制**: 减少重复请求
- **懒加载**: 按需加载组件和数据

## 📱 页面路由

### 主要页面
- **仪表板**: `/` - 系统概览和统计
- **商品管理**: `/products` - 商品CRUD操作
- **供应商管理**: `/suppliers` - 供应商CRUD操作
- **入库管理**: `/inventory/inbound` - 入库记录管理
- **出库管理**: `/inventory/outbound` - 出库记录管理

### 测试页面
- **系统测试**: `/system-test.html` - API功能测试
- **连接测试**: `/api-connection-test.html` - 网络连接测试

## 🔍 故障排除

### 常见问题

1. **前端页面无法加载**
   - 检查前端服务器状态: `http://localhost:5174`
   - 查看浏览器控制台错误信息
   - 确认Node.js和npm版本兼容性

2. **API请求失败**
   - 检查后端服务器状态: `http://localhost:3001/health`
   - 验证API端点配置
   - 检查网络连接和CORS设置

3. **数据库连接问题**
   - 验证Supabase连接配置
   - 检查环境变量设置
   - 确认数据库服务状态

### 调试工具
- **健康检查**: `/health` 端点检查服务状态
- **系统测试**: `/system-test.html` 测试所有API功能
- **开发者工具**: 浏览器Console和Network标签
- **服务器日志**: 后端控制台输出详细日志

## 📈 扩展功能规划

### 已规划功能
1. **用户认证系统**
   - 用户注册/登录
   - 权限角色管理
   - 操作日志记录

2. **高级报表功能**
   - 销售趋势分析
   - 库存周转率统计
   - 供应商绩效评估

3. **移动端支持**
   - 响应式设计优化
   - PWA应用支持
   - 移动端专用功能

4. **数据导入导出**
   - Excel数据导入
   - 报表数据导出
   - 数据备份恢复

## 📝 开发规范

### 代码结构
```
frontend/
├── src/
│   ├── components/     # 公共组件
│   ├── views/         # 页面组件
│   ├── router/        # 路由配置
│   ├── config/        # 配置文件
│   ├── utils/         # 工具函数
│   └── assets/        # 静态资源

backend/
├── src/
│   ├── routes/        # API路由
│   ├── models/        # 数据模型
│   ├── config/        # 配置文件
│   └── utils/         # 工具函数
```

### API规范
- **RESTful设计**: 标准HTTP方法和状态码
- **统一响应格式**: `{ success: boolean, data: any, message: string }`
- **错误处理**: 详细的错误信息和错误码
- **参数验证**: 严格的输入参数验证

### 数据库规范
- **命名规范**: 小写字母和下划线
- **外键约束**: 保证数据完整性
- **索引优化**: 提高查询性能
- **数据类型**: 合适的数据类型选择

## 🎯 总结

便利店进销存系统是一个功能完整、技术先进的库存管理解决方案。系统采用现代化的技术栈，提供直观的用户界面和强大的数据管理能力。通过标准化的开发流程和完善的功能设计，系统能够满足便利店日常运营的各种需求。

**核心优势**:
- ✅ 功能完整 - 覆盖进销存全流程
- ✅ 技术先进 - 使用现代化技术栈
- ✅ 用户友好 - 直观的操作界面
- ✅ 性能优秀 - 快速响应和数据处理
- ✅ 扩展性强 - 支持功能扩展和定制

---

**文档维护**: 本文档基于实际代码实现，与系统功能保持同步更新。如有疑问或建议，请及时反馈。

## 📋 数据库架构更新日志

### v2.0.0 (当前版本) - 多对多关系架构
**更新时间**: 2024年

**重大变更**:
1. **供应商-商品关系重构**
   - 从一对多关系改为多对多关系
   - 新增 `supplier_products` 中间表
   - 移除 `products` 表的 `supplier_id` 外键字段

2. **数据库表结构优化**
   - 核心表数量: 4个 → 5个
   - 新增主要供应商标识 (`is_primary`)
   - 优化索引设计和查询性能

3. **业务逻辑增强**
   - 支持一个商品多个供应商
   - 智能供应商推荐功能
   - 入库时自动维护关联关系

**影响范围**:
- ✅ 前端服务层已更新 (`supabaseSupplier.js`)
- ✅ 数据库设计文档已更新 (v2.0.0)
- ✅ 完整功能文档已更新
- ⚠️ 需要执行数据库迁移脚本 (`remove-supplier-id-from-products.sql`)

**迁移说明**:
执行以下SQL脚本完成数据库结构迁移:
```sql
-- 详见: remove-supplier-id-from-products.sql
-- 1. 删除外键约束和索引
-- 2. 移除 supplier_id 字段
-- 3. 验证表结构变更
```

### v1.0.0 - 初始版本
**更新时间**: 2024年初

**初始设计**:
- 基于一对多关系的供应商-商品设计
- 4个核心表: products, suppliers, inbound_records, outbound_records
- 商品表包含 supplier_id 外键字段