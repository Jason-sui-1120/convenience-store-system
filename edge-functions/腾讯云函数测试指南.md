# 腾讯云函数测试指南

## 当前状态 ✅
腾讯云函数 `inventory-api` 已成功部署并运行：
- ✅ 错误145已修复
- ✅ 函数正常启动（7ms响应时间）
- ✅ 内存使用正常（12.55MB）
- ✅ 支持直接测试和API网关调用

## 测试方法

### 1. 直接函数测试（当前状态）
在腾讯云控制台的"函数代码"页面点击"测试"按钮：
```json
{
  "key1": "test value 1",
  "key2": "test value 2"
}
```

**预期结果**：
```json
{
  "statusCode": 200,
  "headers": {
    "Content-Type": "application/json",
    "Access-Control-Allow-Origin": "*"
  },
  "body": "{\"success\":true,\"message\":\"库存管理系统API运行正常\",\"timestamp\":\"2025-01-29T15:20:00.000Z\",\"environment\":\"Tencent Cloud Function\",\"version\":\"2.0 (修复版)\",\"availableEndpoints\":[...],\"testData\":{\"products\":5,\"suppliers\":2,\"inboundRecords\":1,\"outboundRecords\":1}}"
}
```

### 2. API网关测试（推荐）
需要配置API网关触发器才能进行HTTP API测试。

#### 配置API网关触发器：
1. 在腾讯云函数控制台，进入 `inventory-api` 函数
2. 点击"触发器管理"选项卡
3. 点击"创建触发器"
4. 选择触发器类型：**API网关触发器**
5. 配置参数：
   - **API服务**: 新建API服务
   - **API名称**: inventory-api
   - **请求方法**: ANY
   - **发布环境**: 发布
   - **鉴权方法**: 免鉴权
6. 点击"提交"

#### 获取API网关地址：
配置完成后，你将获得一个API网关地址，格式类似：
```
https://service-xxxxxxxx-xxxxxxxxx.gz.apigw.tencentcs.com/release/
```

#### 测试API端点：
使用获得的API网关地址测试各个端点：

**健康检查**：
```bash
curl https://your-api-gateway-url/api/health
```

**获取商品列表**：
```bash
curl https://your-api-gateway-url/api/products
```

**获取供应商列表**：
```bash
curl https://your-api-gateway-url/api/suppliers
```

## 部署更新

### 使用最新修复版本：
1. 下载 `scf-deploy-fixed.zip` (4KB)
2. 在腾讯云控制台上传更新
3. 点击"部署"按钮

### 验证部署：
1. 点击"测试"按钮，确认返回健康检查信息
2. 检查日志，确认没有错误
3. 配置API网关触发器进行HTTP测试

## API端点列表

### 商品管理
- `GET /api/products` - 获取商品列表
- `POST /api/products` - 创建新商品
- `PUT /api/products/{id}` - 更新商品
- `DELETE /api/products/{id}` - 删除商品

### 供应商管理
- `GET /api/suppliers` - 获取供应商列表
- `POST /api/suppliers` - 创建新供应商
- `PUT /api/suppliers/{id}` - 更新供应商
- `DELETE /api/suppliers/{id}` - 删除供应商

### 入库管理
- `GET /api/inbound` - 获取入库记录
- `POST /api/inbound` - 创建入库记录

### 出库管理
- `GET /api/outbound` - 获取出库记录
- `POST /api/outbound` - 创建出库记录

## 前端配置

### 更新API地址
获得API网关地址后，需要更新前端配置：

1. 编辑 `frontend/src/config/api.js`
2. 更新 `BASE_URL` 为你的API网关地址
3. 重新构建和部署前端

## 故障排除

### 如果仍然出现404错误：
1. 确认API网关触发器已正确配置
2. 检查请求URL是否包含正确的路径
3. 查看函数日志确认请求格式

### 如果出现CORS错误：
- 已配置完整的CORS支持，应该不会出现此问题

### 如果出现超时错误：
- 当前配置30秒超时，对于简单API操作足够

## 成本估算
- 免费额度：每月100万次调用
- 内存：128MB
- 预计成本：基本免费使用

## 下一步
1. 配置API网关触发器
2. 获取API网关地址
3. 更新前端配置
4. 测试完整的前后端集成